name: "Build admin uberjar"

include:
- path: cider-ci/install-ruby_task-component.yml
  submodule: [leihs-ui]

git_options:
  submodules:
    include_match: ^.*$

traits:
  JDK 8: true
  Leiningen 2: true
  npm: true


# note build-ui is strictly not necessary since build invokes it itself
# however caching is much more efficient this way
#
scripts:
  build-leihs-ui-for-admin:
    start_when:
      install-ruby-passed: {script_key: install-ruby}
    timeout: 10 minutes
    body: ${LEIHS_ADMIN_DIR}/leihs-ui/bin/build
    exclusive_executor_resource: build-leihs-ui
  build-admin-uberjar:
    start_when:
      install-ruby: { script_key: install-ruby }
      build-ui: { script_key: build-leihs-ui-for-admin }
    exclusive_executor_resource: build_admin_uberjar
    body: ${LEIHS_ADMIN_DIR}/bin/build
